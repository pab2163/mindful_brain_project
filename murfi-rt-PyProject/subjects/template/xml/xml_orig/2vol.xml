<?xml version="1.0" encoding="UTF-8"?>

<!-- configuration file for the example dataset -->

<!-- setup for connecting to and receiving images from the MRI scanner -->
<scanner>
  <option name="imageSource">     VSEND  </option>

  <option name="tr">              1.20    </option>
  <option name="measurements">    33   </option>

  <option name="save">            true   </option>>
</scanner>

<study>
  <option name="softwareDir">/opt/murfi</option>
  <option name="shutdownAfterRun">true</option>
</study>

<!-- processing steps -->
<processor>
  <!-- mosaic the images for 2D display -->
  <module name="mosaic">
    <output>display</output>
    <output>log</output>
  </module>


  <!-- brain mask computation -->
  <module name="mask-gen">
    <option name="makeavail">true</option>

    <!-- the roi name this mask can be referenced by in later modules
         and the data store -->
    <option name="roiID"> brain </option>

    <!-- threshold at a proportion of the mean image intensity -->
    <option name="threshold"> 0.5 </option>

    <!-- whether to save the mask to a file (good idea) -->
    <option name="save"> false </option>
  </module>


  <!-- roi mask loading -->
  <module name="mask-load">
    <option name="makeavail">true</option>

    <!-- the roi name this mask can be referenced by in later
         modules and the data store -->
    <option name="roiID"> active </option>

    <!-- filename to load the mask from relative to subject mask directory
         (if present, overrides generation parms below) -->
    <option name="filename"> vis </option>

    <!-- whether to align the mask to the series reference after
         reading it in -->
    <option name="align"> true </option>

    <!-- whether to save the mask to a file (good idea) -->
    <option name="save"> false </option>
  </module>

  <!-- deviation of voxel intensity from expected value  -->
  <module name="incremental-glm">
    <option name="makeavail">true</option>
    <output>display</output>

    <option name="maskRoiID">brain</option>

    <!-- design matrix -->
    <design>
      <option name="disabled"> false </option>

      <!-- parameters specifying neural conditions of interest -->

      <!-- each condition should have its own vector of "on" trs as 1s
           and the rest 0s. if there is a cyclic block pattern then
           only one cycle's worth needs to be specified, the program
           will repeat that pattern until the end of the scan. -->
      <option name="condition" conditionName="on">
        1 1 1 1 1 1 1 1

      </option>

      <option name="conditionShift"> 0 </option>

      <!-- parameters specifying nuisance basis functions -->

      <!-- trend regressors will be added up to the order
           specified here -->
      <option name="maxTrendOrder"> 1 </option>

      <!-- model subject head motion (probably just want one of these) -->
      <option name="modelMotionParameters"> false </option>
      <option name="modelMotionDerivatives"> false </option>
      <option name="modelFramewiseDisplacement"> false </option>

      <!-- model temporal derivatives of neural conditions -->
      <option name="modelTemporalDerivatives"> false </option>

      <!-- these nuisance regressors model neural events of no
           interest for your real-time analysis.  for example, in a
           brain state triggering experiment you do not want the
           evoked response from the triggered stimulus to go as
           unaccounted for variance. -->
      <option name="modelEvents"> false </option>

      <!-- needed to know how many columns to reserve for the design
           matrix. adding unnecessary columns will slow down
           estimation a lil, specifying too few will result in
           unmodeled events. count proper.  -->
      <option name="maxNumEvents"> 0 </option>

      <!-- duration of each event (tr) -->
      <option name="eventDuration"> 0 </option>


      <!-- these nuisance regressors model artifacts in the image
           timeseries. -->
      <option name="modelArtifacts"> false </option>
      <option name="maxNumArtifacts"> 0 </option>

      <option name="save"> false </option>
    </design>
  </module>


  <!-- compute current activation -->
  <module name="current-activation">
    <output>display</output>
    <option name="makeavail">true</option>

    <option name="modelFitModuleID"> incremental-glm </option>
    <option name="modelFitRoiID"> brain </option>
    <option name="maskRoiID"> brain </option>

    <option name="numDataPointsForErrEst">20</option>
    <option name="save"> false </option>
  </module>


  <!-- compute feedback -->
  <module name="roi-combine">
    <option name="makeavail">true</option>
    <option name="print"> true </option>

    <output>infoserver</output>
    <output>infoclient</output>

    <option name="method"> weighted-ave </option>

    <option name="maskRoiID"> active </option>

    <option name="inputModuleID"> current-activation </option>
    <option name="inputDataName"> activation-img </option>
    <option name="inputRoiID"> brain </option>

    <option name="weightModuleID"> incremental-glm </option>
    <option name="weightDataName"> residual_mse-img </option>
  </module>

</processor>
